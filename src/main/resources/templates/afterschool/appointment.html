<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover" name="viewport">
    <title>赛事预约</title>
</head>
<link href="/assets/plugins/weui/css/weui.min.css" rel="stylesheet">
<link href="/assets/plugins/bootstarp/css/bootstrap.min.css" rel="stylesheet">
<link href="/assets/plugins/weui/css/weuix.css" rel="stylesheet">
<script src="/assets/plugins/jquery/jquery.min.js"></script>
<script src="/assets/plugins/weui/js/weui.min.js" type="text/javascript"></script>
<!--城市选择器-->
<script src="/assets/plugins/weui/js/picker.city.js" type="text/javascript"></script>
<script src="/assets/plugins/weui/js/zepto.weui.js" type="text/javascript"></script>
<style>
    .user_info {
        background-color: #576b95;
        height: 21%;
        width: 100%;
    }

    .img_info {
        margin-top: 5%;
        margin-left: 2%;
    }

    .text_info {
        white-space: nowrap;
        text-overflow: ellipsis;
        word-break: break-all;
        overflow: hidden;
    }

</style>
<body ontouchstart>
<div class="container" id="container"></div>
<div class="page home js_show">
    <div class="weui-cells user_info">
        <div class="img_info">
            <img class="img-circle" src="${user.headimgurl}">
        </div>
        <div style="margin-top: 10%;">
            <label class="text_info">微信名：${user.nickname}</label>
            <label class="text_info" hidden="hidden" id="openId">${user.openid}</label>
            <label class="text_info" hidden="hidden" id="activeCode">${activeCode}</label>
        </div>
    </div>
    <div class="weui-cells__title">请填写个人信息</div>
    <div class="weui-cells weui-cells_form" id="form">
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">姓名</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" id="realname" name="realname" placeholder="请填写真实姓名..." type="text">
            </div>
        </div>

        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">身份证</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" id="idCard" name="idCard" placeholder="请填写身份证号码..." type="text">
            </div>
        </div>

        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">手机号</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" id="tel" name="tel" placeholder="请填写手机号..." type="Number">
            </div>
        </div>

        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">同行人数</label></div>
            <div class="weui-cell__bd">
                <input class="weui-switch" type="checkbox">
            </div>
        </div>

        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label" for="homeCity">所在城市</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" id="homeCity" readonly type="text" value="陕西省 汉中市 勉县">
            </div>
        </div>

        <div class="weui-cell weui-cell_active weui-cell_access weui-cell_select weui-cell_select-after">
            <div class="weui-cell__hd"><label class="weui-label">座位类型</label></div>
            <div class="weui-cell__bd" id="showPicker">观众席座位</div>
            <div class="weui-cell__bd" hidden="hidden" id="showPicker_val">prize_00001</div>
        </div>
        <br/><br/>
        <div class="weui-form__opr-area">
            <a class="weui-btn weui-btn_primary" href="javascript:" onclick="sumbit()">提交信息</a>
        </div>

    </div>
    <!-- <input type="tel" class="weui_input" required pattern="[0-9]{11}" placeholder="输入你现在的手机号" emptyTips="请输入手机号" notMatchTips="请输入正确的手机号">
     <input type="text" required pattern="REG_IDNUM" placeholder="输入你的身份证号码" emptyTips="请输入身份证号码" notMatchTips="请输入正确的身份证号码">-->
</div>
</body>

<script>
    /*是否同行*/
    var voteDouble = false;

    function sumbit() {
        var confirm = weui.confirm('请确定填写信息准确无误', {
            title: '提交预约信息',
            buttons: [{
                label: '确定',
                type: 'primary',
                onClick: function () {
                    /*openId*/
                    var openId = $("#openId").text();
                    /*真实姓名*/
                    var realname = $("#realname").val();
                    /*身份证*/
                    var idCard = $("#idCard").val();
                    /*手机号*/
                    var tel = $("#tel").val();
                    /*所在城市*/
                    /*活动code*/
                    var activeCode = $("#activeCode").text();
                    /*座位类型--prizeCode*/
                    var showPicker = $("#showPicker_val").text();
                    var userInfo = {};
                    userInfo.realname = realname;
                    userInfo.idCard = idCard;
                    userInfo.telNum = tel;
                    userInfo.openId = openId;
                    userInfo.activeCode = activeCode;
                    userInfo.prizeCode = showPicker;
                    $.ajax({
                        method: "GET",
                        dataType: "json",
                        data: userInfo,
                        contentType: "application/json;charset=utf-8",
                        url: '${ctx!}/prize/register',
                        async: false,
                        success: function (data) {
                            console.log(data);
                            if (data.code == 0) {
                                window.location.href = "${ctx!}/prize/success";
                            } else {
                                confirm.hide(function () {
                                    weui.alert(data.message);
                                });
                            }
                        }
                    });
                }
            }, {
                label: '取消',
                type: 'default',
                onClick: function () {
                    console.log('取消')
                }
            }]
        });
    }


    /*城市选择器*/
    $("#homeCity").cityPicker({
        title: "选择出发地",
        onChange: function (picker, values, displayValues) {
            console.log(values, displayValues);
        }
    });

    /*通行人数*/
    $('.weui-switch').on('change', function () {
        var on = $(this).is(':checked');
        if (on) {
            voteDouble = true;
        } else {
            voteDouble = false;
        }
    });


    /*席位选择器*/
    $('#showPicker').on('click', function () {
        weui.picker([{
            label: '观众席座位',
            disabled: true,
            value: 'prize_00001'
        }, {
            label: '畅饮观众席',
            value: 'prize_00002'
        }], {
            className: 'showPicker',
            container: 'body',
            defaultValue: [0],
            onChange: function (result) {
                //console.log(result);
            },
            onConfirm: function (result) {
                console.log(result);
                $("#showPicker").text(result[0].label);
                $("#showPicker_val").text(result[0].value);
            },
            id: "showPicker",
            title: '请选择座位类型'
        });
    });
</script>
</html>